<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog  
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"  
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">
                      
    <changeSet  id="1"  author="julio.oliveira">  
      	<sql>
      		CREATE TABLE ALIMENTARY_BOLUS (
				ALIMENTARY_BOLUS_ID INT  IDENTITY (1,1) NOT NULL ,
				INSULIN_CALCULATION_TYPE_ID INT NOT NULL, CONSTRAINT FK_AL_BOLUS_INS_CALC_TYPE FOREIGN KEY (INSULIN_CALCULATION_TYPE_ID)
			        REFERENCES INSULIN_CALCULATION_TYPE (INSULIN_CALCULATION_TYPE_ID),
				FOODS_IDS VARCHAR(50), 
				RESULT_VALUE NUMERIC(5,2) NOT NULL,
				REGISTER_DATE DATETIME NOT NULL,
				LAST_UPDATE_DATE DATETIME,
				USER_ID INT NOT NULL
			); 
			
			CREATE TABLE CORRECTION_BOLUS (
				CORRECTION_BOLUS_ID INT  IDENTITY (1,1) NOT NULL ,
				INSULIN_CALCULATION_TYPE_ID INT NOT NULL, CONSTRAINT FK_CORR_BOLUS_INS_CALC_TYPE FOREIGN KEY (INSULIN_CALCULATION_TYPE_ID)
			        REFERENCES INSULIN_CALCULATION_TYPE (INSULIN_CALCULATION_TYPE_ID),
				BLOOD_GLUCOSE_ID INT NOT NULL, CONSTRAINT FK_CORR_BOLUS_BLOOD_GLUCOSE FOREIGN KEY (BLOOD_GLUCOSE_ID)
			        REFERENCES BLOOD_GLUCOSE (GLUCOSE_ID), 
				RESULT_VALUE NUMERIC(5,2) NOT NULL,
				REGISTER_DATE DATETIME NOT NULL,
				LAST_UPDATE_DATE DATETIME,
				USER_ID INT NOT NULL
			); 	
		</sql>
    </changeSet>
    
    <changeSet  id="2"  author="julio.oliveira">  
      	<sql>
    		ALTER TABLE INSULIN_CALCULATION DROP CONSTRAINT FK_INS_CALC_INS_CALC_TYPE;
			
			ALTER TABLE INSULIN_CALCULATION DROP CONSTRAINT FK_INS_CALC_GLUCOSE;
			
			ALTER TABLE INSULIN_CALCULATION DROP COLUMN GLUCOSE_ID;
			
			ALTER TABLE INSULIN_CALCULATION DROP CONSTRAINT FK_INS_CALC_FOOD;
			
			ALTER TABLE INSULIN_CALCULATION DROP COLUMN FOOD_ID;
			
			ALTER TABLE INSULIN_CALCULATION ADD ALIMENTARY_BOLUS_ID INT;
			
			ALTER TABLE INSULIN_CALCULATION ADD CORRECTION_BOLUS_ID INT;
			
			ALTER TABLE INSULIN_CALCULATION_TYPE ADD QTY_CARB_CONS_UNIT_INSULIN INT;
			
			ALTER TABLE BLOOD_GLUCOSE ALTER COLUMN USER_ID INT NOT NULL;
			
			ALTER TABLE FOOD ALTER COLUMN USER_ID INT NOT NULL;
			
			ALTER TABLE INSULIN_CALCULATION ALTER COLUMN USER_ID INT NOT NULL;	
			
			ALTER TABLE INSULIN_CALCULATION_TYPE ALTER COLUMN USER_ID INT NOT NULL;	
		</sql>
	</changeSet>
	
	<changeSet  id="3"  author="julio.oliveira">  
      	<sql>
      		ALTER TABLE ALIMENTARY_BOLUS ADD CONSTRAINT PK_ALIMENTARY_BOLUS PRIMARY KEY CLUSTERED (ALIMENTARY_BOLUS_ID);
      		
      		ALTER TABLE CORRECTION_BOLUS ADD CONSTRAINT PK_CORRECTION_BOLUS PRIMARY KEY CLUSTERED (CORRECTION_BOLUS_ID);
      		
			ALTER TABLE INSULIN_CALCULATION ADD CONSTRAINT FK_INS_CALC_AL_BOLUS FOREIGN KEY (ALIMENTARY_BOLUS_ID) REFERENCES ALIMENTARY_BOLUS (ALIMENTARY_BOLUS_ID);
					
			ALTER TABLE INSULIN_CALCULATION ADD CONSTRAINT FK_INS_CALC_CORR_BOLUS FOREIGN KEY (CORRECTION_BOLUS_ID) REFERENCES CORRECTION_BOLUS (CORRECTION_BOLUS_ID);
		</sql>
	</changeSet>
</databaseChangeLog>


